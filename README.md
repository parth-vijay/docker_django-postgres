# Docker Compose with Django, Postgresql and PGAdmin

For this project, you need to create a Dockerfile, a Python dependencies file, and a docker-compose.yml file. (You can use either a .yml or .yaml extension for this file.)

## Create an empty project directory:

	mkdir project_docker && cd project_docker

## Create python environment:

	virtualenv env

## Activate an environment:

For Linux/Mac - 
	
	source env/bin/activate

For Windows - 
	
	.\bin\Scripts\activate

## Create a **Dockerfile** in your project directory and add following content:

	FROM python:3
	ENV PYTHONUNBUFFERED 1
	RUN mkdir /code
	WORKDIR /code
	COPY requirements.txt /code/
	RUN pip install -r requirements.txt
	COPY . /code/

## Install *django* and *psycopg2-binary* library using pip:

	pip3 install django
	pip3 install psycopg2-binary

## Freeze the *requirements.txt* file:

	pip3 freeze > requirements.txt

## Create a file **docker-compose.yml** and add following content:

	version: '3'
	services:
		db:
		    image: postgres
		    restart: unless-stopped
		    environment:
		      - POSTGRES_DB=postgres
		      - POSTGRES_USER=postgres
		      - POSTGRES_PASSWORD=password
		    volumes:
		      - ./postgres-data:/var/lib/postgresql/data
		    # links:
		      # - "pgadmin"
		pgadmin:
		    image: "dpage/pgadmin4"
		    restart: unless-stopped
		    depends_on:
		      - db
		    environment:
		      PGADMIN_DEFAULT_EMAIL: "yoouremail@gmail.com"
		      PGADMIN_DEFAULT_PASSWORD: "password"  //Same you given in above POSTGRES_PASSWORD//
		      PGADMIN_LISTEN_PORT: 80
		    ports: 
		      - "5050:80"
		web:
		    build: .
		    command: python manage.py runserver 0.0.0.0:8000
		    restart: unless-stopped
		    volumes:
		      - .:/code
		    ports: 
		      - "8000:8000"
		    depends_on:
		      - db
	volumes: 
		postgres-data:

## Create the Django project by running the *docker-compose run* command as follows:

	sudo docker-compose run web django-admin startproject composeexample .

If you are running Docker on Linux, the files django-admin created are owned by root. This happens because the container runs as the root user. Change the ownership of the new files.

		sudo chown -R $USER:$USER .

If you are running Docker on Mac or Windows, you should already have ownership of all files, including those generated by django-admin.

## Connect the database(Postgresql):

In your project directory, edit the composeexample/settings.py file.
Replace the DATABASES = ... with the following:

		# setting.py   
		DATABASES = {
		    'default': {
		        'ENGINE': 'django.db.backends.postgresql_psycopg2',
		        'NAME': 'postgres',  //Name you given in docker-compose.yml//
		        'USER': 'postgres',  //Username you given in docker-compose.yml//
		        'PASSWORD': 'postgres',  //Password you given in docker-compose.yml//
		        'HOST': 'db',  
		        'PORT': 5432,
		    }
		}

## Run the docker-compose up command from the top level directory for your project:

		sudo docker-compose up
		sudo docker-compose up -d (To run the container in the backgorund)

## TO check the list of running container:

		sudo docker ps 

## To stop the running container:

		sudo docker-compose down

To check the Django app, go to **localhost:8000** on your browser.
And to see the PGAdmin page, go to **localhost:5050** and login using your email and password you given in *pgadmin* service in *docker-compose.yml*.
